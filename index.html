<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mini P2P Chat</title>
</head>
<body>
  <h2>P2P Chat (PeerJS)</h2>

  <div>
    <button id="create">Créer une connexion</button>
    <p>Ton ID : <span id="my-id">-</span></p>
  </div>

  <div>
    <input id="peer-id" placeholder="ID de l'autre joueur" />
    <button id="connect">Rejoindre une connexion</button>
  </div>

  <div>
    <input id="message" placeholder="Message..." />
    <button id="send">Envoyer</button>
  </div>

  <pre id="log"></pre>

  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    const myIdDisplay = document.getElementById('my-id');
    const log = document.getElementById('log');
    const messageInput = document.getElementById('message');

    let peer = null;
    let conn = null;

    const logMessage = (msg) => {
      log.textContent += msg + '\n';
    };

    document.getElementById('create').onclick = () => {
      peer = new Peer();
      peer.on('open', (id) => {
        myIdDisplay.textContent = id;
        logMessage("Ton ID: " + id);
      });

      peer.on('connection', (connection) => {
        conn = connection;
        setupConnection();
      });
    };

    document.getElementById('connect').onclick = () => {
      const peerId = document.getElementById('peer-id').value;
      conn = peer.connect(peerId);
      setupConnection();
    };

    function setupConnection() {
      conn.on('open', () => {
        logMessage("Connecté !");
        conn.on('data', (data) => {
          logMessage("Lui: " + data);
        });
      });
    }

    document.getElementById('send').onclick = () => {
      const msg = messageInput.value;
      if (conn && conn.open) {
        conn.send(msg);
        logMessage("Toi: " + msg);
        messageInput.value = '';
      }
    };
  </script>
</body>
</html>